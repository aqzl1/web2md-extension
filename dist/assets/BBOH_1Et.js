import{b as o}from"./DY9jeWLg.js";o.runtime.onInstalled.addListener(()=>{o.contextMenus.create({id:"convert-selection-to-markdown",title:"转换为 Markdown (Web2MD)",contexts:["selection"]})});o.contextMenus.onClicked.addListener(async(t,e)=>{var i,r;if(console.log("[Web2MD] Menu clicked:",t.menuItemId,"Selection:",(i=t.selectionText)==null?void 0:i.substring(0,50)),t.menuItemId==="convert-selection-to-markdown"&&t.selectionText){if(!(e!=null&&e.id)){s("错误","无法获取当前标签页信息");return}try{console.log("[Web2MD] Sending message to tab:",e.id);const n=await o.tabs.sendMessage(e.id,{action:"convertAndCopySelection",selectionText:t.selectionText});console.log("[Web2MD] Response from content script:",n),n!=null&&n.success?s("Web2MD","选中内容已转换为 Markdown 并复制到剪贴板！"):s("Web2MD","复制失败，请手动复制")}catch(n){if(console.error("Error sending message to content script:",n),(r=n.message)!=null&&r.includes("Could not establish connection"))try{console.log("[Web2MD] Injecting content script..."),await o.scripting.executeScript({target:{tabId:e.id},files:["content/content-script.js"]}),await new Promise(l=>setTimeout(l,100));const c=await o.tabs.sendMessage(e.id,{action:"convertAndCopySelection",selectionText:t.selectionText});console.log("[Web2MD] Response after injection:",c),c!=null&&c.success?s("Web2MD","选中内容已转换为 Markdown 并复制到剪贴板！"):s("Web2MD","复制失败，请手动复制")}catch(c){console.error("[Web2MD] Injection failed:",c),s("Web2MD","转换出错: 请刷新页面后重试")}else s("Web2MD",`转换出错: ${n.message}`)}}});function s(t,e){o.notifications.create({type:"basic",iconUrl:o.runtime.getURL("assets/icon-48.png"),title:t,message:e})}
