import{b as I}from"./DY9jeWLg.js";function H(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}function v(e,t){return Array(t+1).join(e)}function N(e){return e.replace(/^\n*/,"")}function E(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}function S(e){return E(N(e))}var W=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function y(e){return b(e,W)}var D=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function R(e){return b(e,D)}function F(e){return x(e,D)}var M=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function $(e){return b(e,M)}function U(e){return x(e,M)}function b(e,t){return t.indexOf(e.nodeName)>=0}function x(e,t){return e.getElementsByTagName&&t.some(function(r){return e.getElementsByTagName(r).length})}var l={};l.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}};l.lineBreak={filter:"br",replacement:function(e,t,r){return r.br+`
`}};l.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,r){var n=Number(t.nodeName.charAt(1));if(r.headingStyle==="setext"&&n<3){var i=v(n===1?"=":"-",e.length);return`

`+e+`
`+i+`

`}else return`

`+v("#",n)+" "+e+`

`}};l.blockquote={filter:"blockquote",replacement:function(e){return e=S(e).replace(/^/gm,"> "),`

`+e+`

`}};l.list={filter:["ul","ol"],replacement:function(e,t){var r=t.parentNode;return r.nodeName==="LI"&&r.lastElementChild===t?`
`+e:`

`+e+`

`}};l.listItem={filter:"li",replacement:function(e,t,r){var n=r.bulletListMarker+"   ",i=t.parentNode;if(i.nodeName==="OL"){var a=i.getAttribute("start"),c=Array.prototype.indexOf.call(i.children,t);n=(a?Number(a)+c:c+1)+".  "}var s=/\n$/.test(e);return e=S(e)+(s?`
`:""),e=e.replace(/\n/gm,`
`+" ".repeat(n.length)),n+e+(t.nextSibling?`
`:"")}};l.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,r){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};l.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,r){for(var n=t.firstChild.getAttribute("class")||"",i=(n.match(/language-(\S+)/)||[null,""])[1],a=t.firstChild.textContent,c=r.fence.charAt(0),s=3,o=new RegExp("^"+c+"{3,}","gm"),u;u=o.exec(a);)u[0].length>=s&&(s=u[0].length+1);var d=v(c,s);return`

`+d+i+`
`+a.replace(/\n$/,"")+`
`+d+`

`}};l.horizontalRule={filter:"hr",replacement:function(e,t,r){return`

`+r.hr+`

`}};l.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var r=t.getAttribute("href");r&&(r=r.replace(/([()])/g,"\\$1"));var n=m(t.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+e+"]("+r+n+")"}};l.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,r){var n=t.getAttribute("href"),i=m(t.getAttribute("title"));i&&(i=' "'+i+'"');var a,c;switch(r.linkReferenceStyle){case"collapsed":a="["+e+"][]",c="["+e+"]: "+n+i;break;case"shortcut":a="["+e+"]",c="["+e+"]: "+n+i;break;default:var s=this.references.length+1;a="["+e+"]["+s+"]",c="["+s+"]: "+n+i}return this.references.push(c),a},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};l.emphasis={filter:["em","i"],replacement:function(e,t,r){return e.trim()?r.emDelimiter+e+r.emDelimiter:""}};l.strong={filter:["strong","b"],replacement:function(e,t,r){return e.trim()?r.strongDelimiter+e+r.strongDelimiter:""}};l.code={filter:function(e){var t=e.previousSibling||e.nextSibling,r=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!r},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",r="`",n=e.match(/`+/gm)||[];n.indexOf(r)!==-1;)r=r+"`";return r+t+e+t+r}};l.image={filter:"img",replacement:function(e,t){var r=m(t.getAttribute("alt")),n=t.getAttribute("src")||"",i=m(t.getAttribute("title")),a=i?' "'+i+'"':"";return n?"!["+r+"]("+n+a+")":""}};function m(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function O(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}O.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=p(this.array,e,this.options))||(t=p(this._keep,e,this.options))||(t=p(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function p(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];if(V(i,t,r))return i}}function V(e,t,r){var n=e.filter;if(typeof n=="string"){if(n===t.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof n=="function"){if(n.call(e,t,r))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function _(e){var t=e.element,r=e.isBlock,n=e.isVoid,i=e.isPre||function(P){return P.nodeName==="PRE"};if(!(!t.firstChild||i(t))){for(var a=null,c=!1,s=null,o=k(s,t,i);o!==t;){if(o.nodeType===3||o.nodeType===4){var u=o.data.replace(/[ \r\n\t]+/g," ");if((!a||/ $/.test(a.data))&&!c&&u[0]===" "&&(u=u.substr(1)),!u){o=h(o);continue}o.data=u,a=o}else if(o.nodeType===1)r(o)||o.nodeName==="BR"?(a&&(a.data=a.data.replace(/ $/,"")),a=null,c=!1):n(o)||i(o)?(a=null,c=!0):a&&(c=!1);else{o=h(o);continue}var d=k(s,o,i);s=o,o=d}a&&(a.data=a.data.replace(/ $/,""),a.data||h(a))}}function h(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function k(e,t,r){return e&&e.parentNode===t||r(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var C=typeof window<"u"?window:{};function j(){var e=C.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch{}return t}function G(){var e=function(){};return X()?e.prototype.parseFromString=function(t){var r=new window.ActiveXObject("htmlfile");return r.designMode="on",r.open(),r.write(t),r.close(),r}:e.prototype.parseFromString=function(t){var r=document.implementation.createHTMLDocument("");return r.open(),r.write(t),r.close(),r},e}function X(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch{C.ActiveXObject&&(e=!0)}return e}var K=j()?C.DOMParser:G();function Y(e,t){var r;if(typeof e=="string"){var n=z().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");r=n.getElementById("turndown-root")}else r=e.cloneNode(!0);return _({element:r,isBlock:y,isVoid:R,isPre:t.preformattedCode?Q:null}),r}var g;function z(){return g=g||new K,g}function Q(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function J(e,t){return e.isBlock=y(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=Z(e),e.flankingWhitespace=q(e,t),e}function Z(e){return!R(e)&&!$(e)&&/^\s*$/i.test(e.textContent)&&!F(e)&&!U(e)}function q(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var r=ee(e.textContent);return r.leadingAscii&&T("left",e,t)&&(r.leading=r.leadingNonAscii),r.trailingAscii&&T("right",e,t)&&(r.trailing=r.trailingNonAscii),{leading:r.leading,trailing:r.trailing}}function ee(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function T(e,t,r){var n,i,a;return e==="left"?(n=t.previousSibling,i=/ $/):(n=t.nextSibling,i=/^ /),n&&(n.nodeType===3?a=i.test(n.nodeValue):r.preformattedCode&&n.nodeName==="CODE"?a=!1:n.nodeType===1&&!y(n)&&(a=i.test(n.textContent))),a}var te=Array.prototype.reduce,re=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function f(e){if(!(this instanceof f))return new f(e);var t={rules:l,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(r,n){return n.isBlock?`

`:""},keepReplacement:function(r,n){return n.isBlock?`

`+n.outerHTML+`

`:n.outerHTML},defaultReplacement:function(r,n){return n.isBlock?`

`+r+`

`:r}};this.options=H({},t,e),this.rules=new O(this.options)}f.prototype={turndown:function(e){if(!ae(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=B.call(this,new Y(e,this.options));return ne.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return re.reduce(function(t,r){return t.replace(r[0],r[1])},e)}};function B(e){var t=this;return te.call(e.childNodes,function(r,n){n=new J(n,t.options);var i="";return n.nodeType===3?i=n.isCode?n.nodeValue:t.escape(n.nodeValue):n.nodeType===1&&(i=ie.call(t,n)),L(r,i)},"")}function ne(e){var t=this;return this.rules.forEach(function(r){typeof r.append=="function"&&(e=L(e,r.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function ie(e){var t=this.rules.forNode(e),r=B.call(this,e),n=e.flankingWhitespace;return(n.leading||n.trailing)&&(r=r.trim()),n.leading+t.replacement(r,e,this.options)+n.trailing}function L(e,t){var r=E(e),n=N(t),i=Math.max(e.length-r.length,t.length-n.length),a=`

`.substring(0,i);return r+a+n}function ae(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}console.log("[Web2MD] Content Script loaded");I.runtime.onMessage.addListener(async e=>{var t,r,n;console.log("[Web2MD] Content script received message:",e);try{if(e.action==="convertPage"){const i=oe();return console.log("[Web2MD] Convert page result:",(t=i.markdown)==null?void 0:t.substring(0,50)),i}if(e.action==="convertSelection"){const i=w(e.selectionText);return console.log("[Web2MD] Convert selection result:",(r=i.markdown)==null?void 0:r.substring(0,50)),i}if(e.action==="convertAndCopySelection"){console.log("[Web2MD] Converting and copying selection...");const i=w(e.selectionText);console.log("[Web2MD] Converted markdown:",(n=i.markdown)==null?void 0:n.substring(0,50));const a=await A(i.markdown);return console.log("[Web2MD] Copy result:",a),{success:a}}if(e.action==="copyToClipboard")return console.log("[Web2MD] Copying to clipboard..."),{success:await A(e.text)}}catch(i){return console.error("[Web2MD] Error processing message:",i),{success:!1,error:i}}});async function A(e){console.log("[Web2MD] Copying to clipboard, text length:",e.length);try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function")return console.log("[Web2MD] Using Clipboard API"),await navigator.clipboard.writeText(e),!0}catch(t){console.warn("Clipboard API failed, falling back to execCommand:",t)}try{console.log("[Web2MD] Using execCommand fallback");const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.select();const r=document.execCommand("copy");return document.body.removeChild(t),console.log("[Web2MD] execCommand result:",r),r}catch(t){return console.error("execCommand copy failed:",t),!1}}function oe(){const e=le(),t=new f({headingStyle:"atx",bulletListMarker:"-",codeBlockStyle:"fenced"});t.remove(["script","style","iframe","nav","footer","header","aside"]);const r=t.turndown(e),n={title:document.title.trim(),url:window.location.href,date:new Date().toISOString().split("T")[0],author:ce()};return{markdown:`---
title: "${n.title}"
date: ${n.date}
url: ${n.url}
---

`+r,metadata:n}}function w(e){const t=new f({headingStyle:"atx",bulletListMarker:"-",codeBlockStyle:"fenced"}),r=document.createElement("div");return r.innerHTML=e,{markdown:t.turndown(r)}}function le(){const e=["article",'[role="article"]',".post-content",".article-content",".entry-content","#content","main",".post",".article"];for(const n of e){const i=document.querySelector(n);if(i)return i.innerHTML}const t=document.body.cloneNode(!0);return t.querySelectorAll("nav, footer, header, aside, script, style").forEach(n=>n.remove()),t.innerHTML}function ce(){var r;const e=document.querySelector('meta[name="author"]');if(e&&e.content)return e.content;const t=document.querySelector(".byline, .author, .post-author");return t&&((r=t.textContent)==null?void 0:r.trim())||""}
